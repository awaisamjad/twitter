<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>User Profile</title>
  </head>

  <script>
    function getUsernameFromURL() {
      const path = window.location.pathname // e.g., "/username123"
      const parts = path.split('/') // Split by "/"
      return parts[1] // Get the username (second part of the URL)
    }
    console.log(getUsernameFromURL())

    async function fetchPosts() {
      try {
        const username = getUsernameFromURL()
        const response = await fetch(`/api/posts/${username}`, {
          method : 'POST'
        })
        console.log(response)
        if (!response.ok) {
          throw new Error(`HTTP error! Status: ${response.status}`)
        }
        const posts = await response.json()
        console.log(posts);
        // Render posts dynamically
        const postsContainer = document.getElementById('posts-container')
        if (posts.length === 0) {
          postsContainer.innerHTML = 'No posts available'
        } else {
          console.log("Figure out")
          // postsContainer.innerHTML = posts
          //   .map(
          //     post => `
          //       <div class="post">
          //           <h3>${post.username}</h3>
          //           <p>${post.content}</p>
          //           <footer>Likes: ${post.like_num} | Dislikes: ${post.dislike_num}</footer>
          //           <form action="/delete-post" method="post" class="delete-post-form">
          //               <input type="hidden" name="username" value="${post.username}">
          //               <input type="hidden" name="id" value="${post.id}">
          //               <button type="submit">Delete</button>
          //           </form>
          //       </div>
          //   `
          //   )
          //   .join('')
        }
      } catch (error) {
        console.error('Error fetching posts:', error)
      }
    }

    document.addEventListener('DOMContentLoaded', fetchPosts)
  </script>

  {{ template "nav.html"}}
  <div id="posts-container" class="flex flex-col"></div>
  {{ template "footer.html"}}
  <!-- <div class="flex flex-col w-full border"> -->
  <!-- <form class="w-full" action="/create-post" method="POST">
      <input type="hidden" name="username" value="{{ .Username }}" />
      <div class="w-full">
        <textarea
          class="textarea textarea-bordered rounded-0 w-full min-h-12 h-48"
          id="contents"
          name="contents"
          placeholder="Create a post ..."
          required
        ></textarea>
      </div>
      <div class="join flex flex-row justify-end">
        <label for="attach" class="btn join-item cursor-pointer">Attach</label>
        <input
          type="file"
          id="attach"
          name="attach"
          accept="image/png, image/jpeg"
          class="hidden"
        />
        <button class="btn join-item" type="button">Link</button>
        <button class="btn join-item" type="button">Share</button>
        <button class="btn join-item" type="submit">Post</button>
      </div>
    </form> -->
  <!-- <div class="flex flex-row"> -->
  <!-- </div> -->
</html>
