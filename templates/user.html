<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>User Profile</title>
  </head>

  <script>
    function getUsernameFromURL() {
      const path = window.location.pathname // e.g., "/username123"
      const parts = path.split('/') // Split by "/"
      return parts[1] // Get the username (second part of the URL)
    }
    
    async function fetchPosts() {
      try {
        const username = getUsernameFromURL()

        const response = await fetch(`/${username}`, {
          method: 'POST'
        })
        console.log(response)
        if (!response.ok) {
          throw new Error(`HTTP error! Status: ${response.status}`)
        }
        const postsContainer = document.getElementById('posts-container')
        const posts_response = await response.json()
        if (posts_response.Posts.length === 0) {
          postsContainer.innerHTML = 'No posts available'
        }

        postsContainer.innerHTML = ''
        for (let i = 0; i < posts_response.Posts.length; i++) {
          var post = posts_response.Posts[i]
          console.log('Post ::::', post)
          const postElement = document.createElement('div')
          postElement.id = 'post'
          postElement.className = 'border-b-2 border-x-2 mx-2 p-2'
          postElement.innerHTML = `
                    <img class="w-20" src="/static/images/icons/user.svg" alt = "Pfp" id="profile-picture">
                    <h3>${post.username}</h3>
                    <p>${post.content}</p>
                    <div>Likes: ${post.like_num} | Dislikes: ${post.dislike_num}</div>
                    <form action="/delete-post" method="post" class="delete-post-form">
                        <input type="hidden" name="username" value="${post.username}">
                        <input type="hidden" name="id" value="${post.id}">
                        <button type="submit">Delete</button>
                    </form>
                `
          postsContainer.appendChild(postElement)

          // ? When a user clicks on their post it takes them to a page for the post
          var post_click = document.getElementById('post-click')
          post_click.href = `/${post.username}/${post.id}`
        }
      } catch (error) {
        console.log(error)
      }
    }

    document.addEventListener('DOMContentLoaded', fetchPosts)
  </script>

  {{ template "nav.html"}}
  <a id="post-click" href="">
    <div id="posts-container" class="flex flex-col"></div>
  </a>
  {{ template "footer.html"}}
  <!-- <div class="flex flex-col w-full border"> -->
  <!-- <form class="w-full" action="/create-post" method="POST">
      <input type="hidden" name="username" value="{{ .Username }}" />
      <div class="w-full">
        <textarea
          class="textarea textarea-bordered rounded-0 w-full min-h-12 h-48"
          id="contents"
          name="contents"
          placeholder="Create a post ..."
          required
        ></textarea>
      </div>
      <div class="join flex flex-row justify-end">
        <label for="attach" class="btn join-item cursor-pointer">Attach</label>
        <input
          type="file"
          id="attach"
          name="attach"
          accept="image/png, image/jpeg"
          class="hidden"
        />
        <button class="btn join-item" type="button">Link</button>
        <button class="btn join-item" type="button">Share</button>
        <button class="btn join-item" type="submit">Post</button>
      </div>
    </form> -->
  <!-- <div class="flex flex-row"> -->
  <!-- </div> -->
</html>
